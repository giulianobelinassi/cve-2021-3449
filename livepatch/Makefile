CC=gcc
CFLAGS=-g3 -O2 -fpatchable-function-entry=16,14 -fPIC \
			 -I../ssl-headers/include/ \
			 -I../ssl-headers/ssl/ \
			 -I../ssl-headers/
LDFLAGS=
ULP_PACKER=ulp packer

libcve-2021-3449_livepatch1.so: livepatch.c cve-2021-3449.dsc
	$(CC) $(CFLAGS) -shared -o $@ $< $(LDFLAGS)
	$(ULP_PACKER) $(word 2,$^)

%.o: %.c
	$(CC) $(CFLAGS) -c $<

.PHONY: clean
clean:
	rm -rf *.o *.so *.ulp
