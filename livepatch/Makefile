CC=gcc
CFLAGS=-g3 -O2 -fpatchable-function-entry=16,14 -fPIC \
			 -I../ssl-headers/include/ \
			 -I../ssl-headers/ssl/ \
			 -I../ssl-headers/
LDFLAGS=
ULP_PACKER=ulp packer

cve-2021-3449.ulp: cve-2021-3449.dsc libcve-2021-3449_livepatch1.so
	$(ULP_PACKER) $< -o $@

libcve-2021-3449_livepatch1.so: livepatch.c
	$(CC) $(CFLAGS) -shared -o $@ $^ $(LDFLAGS)
	cp $@ ../openssl-1.1.1d/

%.o: %.c
	$(CC) $(CFLAGS) -c $<

.PHONY: clean
clean:
	rm -rf *.o *.so *.ulp
